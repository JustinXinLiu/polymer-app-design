<link rel="import" href="../../bower_components/polymer/polymer.html">

<dom-module id="bottom-popup-list">
	<template>
		<style include="shared-styles"></style>
		<style>
			:host {
				display: block;
				@apply(--layout-vertical);
			}
			
			#background {
				background-color: var(--primary-text-color);
				@apply(--layout-fit);
				z-index: -1;
			}
			
			.sticky {
				position: fixed;
				top: 44px;
				left: 0;
				right: 0;
				z-index: 100;
				opacity: 0.9;
				transition: all .25s ease-out;
			}
			
			paper-listbox {
				--paper-listbox-color: var(--light-primary-color);
				--paper-listbox-background-color: transparent;
			}
			
			paper-listbox paper-item {
				padding: 0 32px;
				--paper-item-selected: {
					transition: all .25s ease-out;
					background-color: var(--semitransparent-secondary-accent-color);
				};
			}
			
			#actions {
				position: fixed;
				left: 0;
				right: 0;
				bottom: 0;
			}
			
			#actions paper-fab {
				margin: 24px;
			}
			
			paper-fab#select {
				--paper-fab-background: var(--good-color);
				--paper-fab-keyboard-focus-background: var(--secondary-accent-color);
			}
		</style>

		<section id="content">
			<secondary-heading id="heading" class$="[[sticky]]" name="[[name]]" first></secondary-heading>

			<paper-listbox selected="{{selected}}">
				<paper-item>Item 1</paper-item>
				<paper-item>Item 2</paper-item>
				<paper-item>Item 3</paper-item>
				<paper-item>Item 4</paper-item>
				<paper-item>Item 5</paper-item>
				<paper-item>Item 6</paper-item>
				<paper-item>Item 7</paper-item>
				<paper-item>Item 8</paper-item>
				<paper-item>Item 9</paper-item>
				<paper-item>Item 10</paper-item>
				<paper-item>Item 11</paper-item>
				<paper-item>Item 12</paper-item>
				<paper-item>Item 13</paper-item>
				<paper-item>Item 14</paper-item>
				<paper-item>Item 15</paper-item>
				<paper-item>Item 16</paper-item>
			</paper-listbox>

			<div id="background"></div>
		</section>

		<section id="actions" class="center-center horizontal layout">
			<paper-fab id="up" icon="expand-less" on-tap="_onGoUpTap"></paper-fab>
			<paper-fab id="down" icon="expand-more" on-tap="_onGoDownTap"></paper-fab>
			<paper-fab id="select" icon="done" on-tap="_onSelectTap"></paper-fab>
		</section>
	</template>

	<!--<script src="bottom-popup-list.js"></script>-->

	<script>
		Polymer({
			is: 'bottom-popup-list',
			behaviors: [ Polymer.NeonAnimationRunnerBehavior ],
			properties: {
				name: {
					type: String		
				},
				
				type: {
					type: String,
					reflectedToAttribute: true			
				},	
					
				opened: {
					type: Boolean,
					notify: true,
					observer: '_openedChanged'				
				},
				
				selected: {
					type: Number,
					notify: true,
					observer: '_selectedChanged'				
				},		
				
				animationConfig: {
					value: function () {		
						return {
							'entry': [{
								name: 'slide-down-animation',
								node: this.$.content
							}, {
								name: 'scale-up-animation',
								node: this.$.actions,
								timing: { duration: 300, delay: 400, easing: app.ANIMATION_EASE_OUT_BACK }
							}, {
								name: 'fade-in-animation',
								node: this.$.actions
							}],
							
							'exit': [{
								name: 'slide-up-animation',
								node: this.$.content
							}, {
								name: 'scale-down-animation',
								node: this.$.actions,
								timing: { duration: 200, easing: app.ANIMATION_EASE_IN_BACK }
							}, {
								name: 'fade-out-animation',
								node: this.$.actions
							}],
							
							'showActions': [{
								name: 'scale-up-animation',
								node: this.$.actions,
								timing: { duration: 300, easing: app.ANIMATION_EASE_OUT_BACK }
							}, {
								name: 'fade-in-animation',
								node: this.$.actions
							}],
							
							'hideActions': [{
								name: 'scale-down-animation',
								node: this.$.actions,
								timing: { duration: 200, easing: app.ANIMATION_EASE_IN_BACK }
							}, {
								name: 'fade-out-animation',
								node: this.$.actions
							}]
						};
					}
				}
			},
			
			ready: function () {
				this.$.actions.style.display = 'none';
				
				// Sticky effect for the secondary heading
				//
				
				// let effect = new KeyframeEffect(this.$.heading, [
				// 	{ transform: 'rotateX(0)' }, 
				// 	{ transform: 'rotateX(180deg)' 
				// }], 400);
				// let animation = new Animation(effect, this.$.heading.ownerDocument.timeline);
		
				addEventListener('paper-header-transform', (e) => {
					var detail = e.detail;
					var heightDiff = detail.height - detail.condensedHeight;

					if (detail.y === heightDiff) {
						//animation.play();
						// this.async(()=> { 
						this.$.heading.first = false;
						this.sticky = 'sticky';
						// }, 0);
					}
					else {
						this.$.heading.first = true;
						this.sticky = '';
					}
				});
			},
			
			listeners: {
				'neon-animation-finish': '_onNeonAnimationFinish'
			},
			
			_onNeonAnimationFinish: function (e, animation) {
				// switch (animation) {
				// 	case 'showActions':
				// 		this.$.actions.style.display = '';
				// 		break;
				// 	case 'hideActions':
				// 		this.$.actions.style.display = 'none';
				// 		break;
				// }
			},
			
			_selectedChanged: function (selected, oldSelected) {
				if (!oldSelected && selected >= 0) {
					this.$.actions.style.display = '';
					
					this.cancelAnimation();
					this.playAnimation('showActions', 'showActions');
				}
			},
			
			_openedChanged: function(opened) {
				console.log(opened);
			},
			
			_onGoUpTap: function() {
				
			},
			
			_onGoDownTap: function() {
				
			},
			
			_onSelectTap: function() {
				
			}
			
			// open: function () {
			// 	this.$.dropdown.open();
			// },
			// 
			// close: function () {
			// 	this.$.dropdown.close();
			// },
			// 
			// _onTriggerOnTap: function () {
			// 	this.open();		
			// },
			// 
			// _onTriggerOffTap: function () {
			// 	this.close();	
			// }
		});
	</script>
</dom-module>