<link rel="import" href="../../bower_components/polymer/polymer.html">

<dom-module id="section-detail">
	<template>
		<style include="shared-styles"></style>
		<style>
			:host {
				display: block;
				position: relative;
			}
			
			:host([opened]) #overlay {
				opacity: 0.4;
				pointer-events: auto;
			}
			
			value-card-number {
				margin-top: 0;
			}
			
			.sticky {
				position: fixed;
				top: 44px;
				left: 0;
				right: 0;
				z-index: 100;
				opacity: 0.9;
				transition: all .25s ease-out;
			}
		</style>

		<section id="content" class="relative vertical layout">
			<secondary-heading id="heading" class$="[[sticky]]" name="Something important here" first></secondary-heading>
			<value-card-number name="value 1" main-figure-value="12" main-figure-desc="Last Week" main-figure-comparison-value="37"></value-card-number>
			<value-card-chart name="value 2" type="line" main-figure-value="54" main-figure-desc="Last Week" main-figure-comparison-value="37"></value-card-chart>
			<value-card-chart name="value 3" type="bar" main-figure-value="77" main-figure-desc="Last Week" main-figure-comparison-value="37"></value-card-chart>
			<value-card-grid name="detailed data" main-figure-value="7877000" main-figure-desc="Last Year"></value-card-grid>
			<div id="overlay" class="fit"></div>
		</section>

		<spread-menu-button id="action" opened="{{opened}}">
			<paper-fab icon="expand-more" class="dropdown-trigger-on"></paper-fab>
			<paper-fab icon="close" class="dropdown-trigger-off"></paper-fab>
			<div class="dropdown-content">
				<iron-selector attr-for-selected="name" selected="{{drillDownType}}">
					<paper-fab id="product" name="product" icon="shopping-basket" mini></paper-fab>
					<paper-fab id="org" name="org" icon="store" mini></paper-fab>
				</iron-selector>
			</div>
		</spread-menu-button>
	</template>

	<!--<script src="section-detail.js"></script>-->

	<script>
		Polymer({
			is: 'section-detail',
			behaviors: [ Polymer.NeonSharedElementAnimatableBehavior ],
		
			properties: {	
				name: {
					type: String
				},
	
				sticky: {
					type: String
				},
				
				drillDownType: {
					type: String,
					notify: true,
					observer: '_drillDownTypeChanged'
				},
	
				mainFigureValue: {
					type: Number
				},
	
				mainFigureAbbr: {
					type: String
				},
	
				mainFigureDesc: {
					type: String
				},
	
				mainFigureComparisonValue: {
					type: Number
				},
				
				opened: {
					type: Boolean,
					notify: true,
					reflectToAttribute: true			
				},
				
				useHeroTransition: {
					type: Boolean,
					observer: '_useHeroTransitionChanged'			
				},
				
				useUpDownTransition: {
					type: Boolean,
					observer: '_useUpDownTransitionChanged'			
				},
				
				_localAnimationConfig: {
					value: function () {		
						return {
							'entry': [{
								name: 'slide-from-right-animation',
								node: this.$.content
							}, {
								animatable: this.$.action,
								type: 'entry'
							}],
							
							'exit': [{
								name: 'slide-right-animation',
								node: this.$.content							
							}, {
								animatable: this.$.action,
								type: 'exit'
							}]										
						};
					}
				},
				
				_localHeroAnimationConfig: {
					value: function () {		
						return {
							'entry': [{
								name: 'hero-animation',
								id: 'hero',
								toPage: this
							}],
							
							'exit': [{
								name: 'hero-animation',
								id: 'hero',
								fromPage: this
							}]										
						};
					}
				},
				
				_localUpDownAnimationConfig: {
					value: function () {		
						return {
							'entry': [{
								name: 'slide-down-animation',
								node: this.$.content
							}, {
								animatable: this.$.action,
								type: 'entry'
							}],
							
							'exit': [{
								name: 'slide-up-animation',
								node: this.$.content
							}, {
								animatable: this.$.action,
								type: 'exit'
							}]										
						};
					}
				}
			},
					
			ready: function () {
				var that = this;
				this.animationConfig = this._localAnimationConfig;

				// Sticky effect for the secondary heading
				//
				
				// let effect = new KeyframeEffect(this.$.heading, [
				// 	{ transform: 'rotateX(0)' }, 
				// 	{ transform: 'rotateX(180deg)' 
				// }], 400);
				// let animation = new Animation(effect, this.$.heading.ownerDocument.timeline);
		
				addEventListener('paper-header-transform', function (e) {
					var detail = e.detail;
					var heightDiff = detail.height - detail.condensedHeight;

					if (detail.y === heightDiff) {
						//animation.play();
						// this.async(()=> { 
						that.$.heading.first = false;
						that.sticky = 'sticky';
						// }, 0);
					}
					else {
						that.$.heading.first = true;
						that.sticky = '';
					}
				});
			},
			
			_useHeroTransitionChanged: function(useHeroTransition) {
				if (useHeroTransition) {
					this.animationConfig = this._localHeroAnimationConfig;
				} else {
					this.animationConfig = this._localAnimationConfig;
				}
			},
			
			_useUpDownTransitionChanged: function(useUpDownTransition) {
				if (useUpDownTransition) {
					this.animationConfig = this._localUpDownAnimationConfig;
				} else {
					this.animationConfig = this._localAnimationConfig;
				}
			},
			
			_drillDownTypeChanged: function(type) {
				switch (type) {
					case 'product':
						app.pageAnimationForward();
						page(`${page.current}/products`);
						break;
					case 'org':
						app.pageAnimationForward();
						page(`${page.current}/orgunits`);
						break;
				}
			}	
		});
	</script>
</dom-module>