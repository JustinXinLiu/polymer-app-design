<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-dropdown/iron-dropdown.html">
<link rel="import" href="../../bower_components/neon-animation/neon-animations.html">

<dom-module id="spread-menu-button">
	<template>
		<style include="shared-styles"></style>
		<style>
			:host {
				display: block;
				position: fixed;
				right: 56px;
				bottom: 56px;
				padding: 16px;
				@apply(--spread-menu-button);
			}
			
			.triggers::content .dropdown-trigger-off {
				background-color: var(--primary-text-color);
			}
			
			#dropdown::content iron-selector > * {
				background-color: var(--default-primary-color);
				margin: 12px;
			}
			
			#dropdown::content iron-selector >:first-child {
				background-color: var(--accent-color);
			}
			
			#dropdown::content iron-selector >:nth-child(2) {
				background-color: var(--secondary-accent-color);
			}
			
			#dropdown::content iron-selector >:nth-child(3) {
				background-color: var(--good-color);
			}
			
			#dropdown::content iron-selector >:nth-child(4) {
				background-color: var(--bad-color);
			}
		</style>

		<div class="triggers relative">
			<div class="fit" on-tap="_onTriggerOffTap">
				<content id="off" select=".dropdown-trigger-off"></content>
			</div>
			<div class="fit" on-tap="_onTriggerOnTap">
				<content id="on" select=".dropdown-trigger-on"></content>
			</div>
		</div>
		<iron-dropdown id="dropdown" opened="{{opened}}" vertical-align="bottom" horizontal-offset="12" vertical-offset="16" open-animation-config="[[openAnimationConfig]]"
		close-animation-config="[[closeAnimationConfig]]">
			<content id="content" select=".dropdown-content"></content>
		</iron-dropdown>
	</template>

	<!--<script src="spread-menu-button.js"></script>-->

	<script>
		Polymer({
			is: 'spread-menu-button',
			behaviors: [ Polymer.NeonAnimationRunnerBehavior ],
		
			properties: {	
				opened: {
					type: Boolean,
					notify: true,
					observer: '_openedChanged'				
				},		
				
				animationConfig: {
					value: function () {			
						return {
							'open': [{
								name: 'fade-in-animation',
								node: this.offElement 
							}, {
								name: 'rotate-clockwise-animation',
								node: this.offElement 
							}, {
								name: 'fade-out-animation',
								node: this.onElement 
							}, {
								name: 'rotate-clockwise-animation',
								node: this.onElement 
							}],
							
							'close': [{
								name: 'fade-out-animation',
								node: this.offElement 
							}, {
								name: 'rotate-anticlockwise-animation',
								node: this.offElement 
							}, {
								name: 'fade-in-animation',
								node: this.onElement 
							}, {
								name: 'rotate-anticlockwise-animation',
								node: this.onElement 
							}]						
						};
					}
				},
				
				openAnimationConfig: {
					value: function () {
						return [{
							name: 'cascaded-animation',
							animation: 'fade-in-animation',
							nodes: this.itemsReversed,
							nodeDelay: 100,
							timing: { delay: 100, duration: 400 }
						}, {
							name: 'cascaded-animation',
							animation: 'scale-up-animation',
							nodes: this.itemsReversed,
							nodeDelay: 100
						}];
					}
				},
				
				closeAnimationConfig: {
					value: function () {
						return [{
							name: 'cascaded-animation',
							animation: 'fade-out-animation',
							nodes: this.items,
							nodeDelay: 100,
							timing: { duration: 300 }
						}, {
							name: 'cascaded-animation',
							animation: 'scale-down-animation',
							nodes: this.items,
							nodeDelay: 100
						}];
					}
				}
			},
			
			get onElement () {
				return this.queryEffectiveChildren('.dropdown-trigger-on');
			},
			
			get offElement () {
				return this.queryEffectiveChildren('.dropdown-trigger-off');
			},
			
			get items () {
				var content = this.queryEffectiveChildren('.dropdown-content');
				// iron-selector
				var child = content.children[0];
				// fabs
				var children = child.children;
				
				return children;				
			},
			
			get itemsReversed () {
				var items = [];
				var length = this.items.length;
				
				for (var i = 1; i <= length; i++) { 
					items.push(this.items[length - i]);
				}
				
				return items;
			},
			
			attached: function () {
			},
			
			listeners: {
				'neon-animation-finish': '_onNeonAnimationFinish',
				'iron-select': '_onIronSelect'
			},
			
			_onNeonAnimationFinish: function (e, animation) {
				switch (animation) {
					case 'open':
						this.onElement.style.display = 'none';
						break;
					case 'close':
						this.offElement.style.display = 'none';
						break;
				}
			},
			
			_openedChanged: function(opened) {
				if (opened) {
					this.fire('paper-dropdown-open');
												
					this.cancelAnimation();	
					this.offElement.style.display = '';	
					this.playAnimation('open', 'open');	
				}
				else {
					this.fire('paper-dropdown-close');					
					
					this.cancelAnimation();		
					this.onElement.style.display = '';	
					this.playAnimation('close', 'close');			
				}
			},
			
			open: function () {
				this.$.dropdown.open();
			},
			
			close: function () {
				this.$.dropdown.close();
			},
			
			_onTriggerOnTap: function () {
				this.open();		
			},
			
			_onTriggerOffTap: function () {
				this.close();	
			},
			
			_onIronSelect: function () {
				this.close();
			}
		});
	</script>
</dom-module>